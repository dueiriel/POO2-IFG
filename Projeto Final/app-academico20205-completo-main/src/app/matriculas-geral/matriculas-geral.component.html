<div class="container mt-4">
  <div class="row">
    <div class="col-md-12">
      <h2>üéì Relat√≥rio de Matr√≠culas</h2>
      
      <!-- Estat√≠sticas -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card text-center bg-primary text-white">
            <div class="card-body">
              <h3>{{ getTotalMatriculas() }}</h3>
              <p class="mb-0">Total de Matr√≠culas</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center bg-success text-white">
            <div class="card-body">
              <h3>{{ getTotalAlunos() }}</h3>
              <p class="mb-0">Alunos Matriculados</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center bg-info text-white">
            <div class="card-body">
              <h3>{{ getTotalCursos() }}</h3>
              <p class="mb-0">Cursos com Alunos</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Filtro -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">üîç Filtros</h5>
        </div>
        <div class="card-body">
          <div class="row align-items-end">
            <div class="col-md-8">
              <label for="filtroTexto" class="form-label">Buscar por nome do aluno ou curso:</label>
              <input type="text" id="filtroTexto" class="form-control" 
                     [(ngModel)]="filtroTexto" 
                     (keyup)="filtrarMatriculas()"
                     placeholder="Digite o nome do aluno ou curso...">
            </div>
            <div class="col-md-4">
              <button type="button" class="btn btn-outline-secondary w-100" 
                      (click)="limparFiltro()">
                Limpar Filtro
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de Matr√≠culas Agrupadas por Aluno -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">üìã Matr√≠culas por Aluno</h5>
        </div>
        <div class="card-body">
          <div *ngIf="matriculasFiltradas.length === 0" class="text-center text-muted py-4">
            <p>Nenhuma matr√≠cula encontrada.</p>
          </div>

          <div *ngFor="let grupo of agrupadoPorAluno() | keyvalue" class="mb-3">
            <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-2">
              <h6 class="mb-0">
                üë§ {{ grupo.value[0].nomeAluno }} 
                <small class="text-muted">(ID: {{ grupo.value[0].idAluno }})</small>
              </h6>
              <div>
                <span class="badge bg-primary me-2">{{ grupo.value.length }} curso{{ grupo.value.length > 1 ? 's' : '' }}</span>
                <button type="button" class="btn btn-sm btn-outline-primary" 
                        (click)="gerenciarMatriculasAluno(grupo.value[0].idAluno)">
                  Gerenciar
                </button>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <div *ngFor="let matricula of grupo.value" class="d-inline-block me-2 mb-2">
                  <span class="badge bg-info text-dark">
                    üìö {{ matricula.nomeCurso }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabela Detalhada (Opcional) -->
      <div class="card mt-4">
        <div class="card-header">
          <h5 class="mb-0">üìä Visualiza√ß√£o Detalhada</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-light">
                <tr>
                  <th scope="col">ID Aluno</th>
                  <th scope="col">Nome do Aluno</th>
                  <th scope="col">ID Curso</th>
                  <th scope="col">Nome do Curso</th>
                  <th scope="col" class="text-center">A√ß√µes</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let matricula of matriculasFiltradas">
                  <td>{{ matricula.idAluno }}</td>
                  <td>{{ matricula.nomeAluno }}</td>
                  <td>{{ matricula.idCurso }}</td>
                  <td>{{ matricula.nomeCurso }}</td>
                  <td class="text-center">
                    <button type="button" class="btn btn-sm btn-outline-primary" 
                            (click)="gerenciarMatriculasAluno(matricula.idAluno)"
                            title="Gerenciar matr√≠culas deste aluno">
                      ‚öôÔ∏è Gerenciar
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Resumo -->
      <div class="mt-4 text-center">
        <small class="text-muted">
          Mostrando {{ matriculasFiltradas.length }} de {{ matriculas.length }} matr√≠culas
        </small>
      </div>
    </div>
  </div>
</div>
